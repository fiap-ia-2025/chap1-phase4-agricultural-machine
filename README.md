# FIAP - Faculdade de Inform√°tica e Administra√ß√£o Paulista

<p align="center">
  <a href="https://www.fiap.com.br/">
    <img src="assets/logo-fiap.png" alt="FIAP - Faculdade de Inform√°tica e Administra√ß√£o Paulista" border="0" width="40%" height="40%">
  </a>
</p>

## üë• Grupo 21


## üë®‚Äçüéì Integrantes:

- Amanda Vieira Pires (RM565045)
- Ana Gabriela Soares Santos (RM565235)
- Bianca Nascimento de Santa Cruz Oliveira (RM561390)
- Milena Pereira dos Santos Silva (RM565464)
- Nayana Mehta Miazaki (RM565045)

## üë©‚Äçüè´ Professores:

### Tutor(a)

- Lucas Gomes Moreira

### Coordenador(a)

- Andr√© Godoi

---

# üåø Sistema de Irriga√ß√£o Inteligente com ESP32

### üé• Assista √† demonstra√ß√£o no YouTube

[![Assista √† demonstra√ß√£o no YouTube](https://img.youtube.com/vi/kO4M81SsNnA/0.jpg)](https://youtu.be/kO4M81SsNnA)


## üìò Descri√ß√£o Geral

Este projeto faz parte de uma solu√ß√£o integrada de **irriga√ß√£o inteligente com ESP32**, desenvolvida como atividade pr√°tica no curso de Intelig√™ncia Artificial da FIAP. Seu principal objetivo √© aplicar conceitos de **automa√ß√£o agr√≠cola**, **monitoramento ambiental**, **programa√ß√£o embarcada** e **persist√™ncia de dados**, simulando um cen√°rio real de controle e otimiza√ß√£o do uso da √°gua em planta√ß√µes.

Esse projeto √© uma extens√£o do projeto j√° desenvolvido no reposit√≥rio[chap1-phase3-agricultural-machine](https://github.com/fiap-ia-2025/chap1-phase3-agricultural-machine), com objetivo de otimiza√ß√£o.

As otimiza√ß√µes realizadas foram:

1. **C√≥digo C++ otimizado**  
   Foram realizadas v√°rias otimiza√ß√µes no c√≥digo C++ do projeto wokwi. Cada otimiza√ß√£o realizada por ser identificada no c√≥digo pelos coment√°rios inseridos.

2. **Banco de dados aprimorado**  
   Entidades n√£o utilizadas foram removidas e novas colunas adicionadas.

3. **Modelagem preditiva com Scikit-learn**
  Foi criada uma modelagem supervisionada utilizando algor√≠timos de classifica√ß√£o da biblioteca scikit-learn.

4. **Interface com Streamlit**
  Foram criadas interfaces para representar graficamente os dados inseridos na base de dados e criar uma intera√ß√£o com a modelagem preditiva.

4. **Integra√ß√£o do Serial Plotter**
  O Seal Plotter foi utilizado na siluma√ß√£o com wokwi para printar as informa√ß√µes coletadas dos sensores, assim como exibi-las graficamente.

5. **Inclus√£o do display LCD no Wokwi**
  Foi inclu√≠do um display LCD na simula√ß√£o wokwi para exibir as informa√ß√µes coletadas diretamente no sistema f√≠sico.

<br>

Al√©m dos t√≥picos abordados acima, o projeto tamb√©m foi restruturado para se adequar ao template padr√£o de projetos.

Seguem abaixo mais detalhes sobre cada t√≥pico evolu√≠do no projeto.

<br>

## C√≥digo C++ otimizado

O c√≥digo foi revisado para otimizar o uso de mem√≥ria RAM no ESP32, garantindo maior efici√™ncia e estabilidade. As principais otimiza√ß√µes realizadas foram:

- **Uso de tipos inteiros menores:**  
  - `interval` definido como `const uint16_t`, suficiente para intervalos de at√© 65 segundos.
  - `phRaw` definido como `int16_t`, pois o valor de `analogRead` vai de 0 a 4095.
- **Uso de `bool` para flags:**  
  - Vari√°veis como `phosphorusAbsent`, `potassiumAbsent` e `shouldIrrigate` usam o tipo `bool`, que ocupa apenas 1 byte.
- **Uso de `char` para status simples:**  
  - Status de nutrientes (`phosphorusStatus`, `potassiumStatus`) s√£o representados por caracteres (`'A'` para ausente, `'P'` para presente), economizando mem√≥ria em rela√ß√£o a strings.
- **Uso de `float` apenas onde necess√°rio:**  
  - Mantido para c√°lculos de pH e umidade, pois sensores anal√≥gicos requerem precis√£o decimal.
- **Convers√£o para tipos menores na exibi√ß√£o:**  
  - Ao exibir a umidade no LCD, √© feito cast para `uint8_t`, j√° que o valor est√° sempre entre 0 e 100.

Essas otimiza√ß√µes tornam o c√≥digo mais eficiente, especialmente em aplica√ß√µes embarcadas onde o uso de mem√≥ria √© cr√≠tico.

<br>

## Banco de dados aprimorado

O banco de dados foi modificado para manter apenas o que de fato est√° sendo utilizado no projeto e incluir informa√ß√µes relevantes, como:

* Remo√ß√£o das tabelas **sensor_umidade**, **sensor_ph**, **sensor_p** e **sensor_k** pois n√£o estavam sendo utlizadas no projeto, apenas eram criadas mas sem utilidade.

* Inclus√£o da coluna **temperatura** na tabela **leitura_sensor**, pois a temperatura √© um dado importante e utilizado no simula√ß√£o wokwi.

<br>

## Modelagem preditiva com Scikit-learn

A modelagem preditiva foi desenvolvida no arquivo `machine_learning.ipynb`, utilizando a biblioteca Scikit-learn para criar um modelo de classifica√ß√£o capaz de prever a necessidade de irriga√ß√£o com base nos dados coletados pelos sensores.

### 1. Objetivo

O objetivo principal da modelagem √© prever automaticamente se a bomba de irriga√ß√£o deve ser acionada, considerando vari√°veis como umidade do solo, pH, presen√ßa de f√≥sforo e pot√°ssio, al√©m da temperatura.

### 2. Pipeline de Machine Learning

O processo de modelagem seguiu as seguintes etapas:

- **Coleta e prepara√ß√£o dos dados:**  
  Os dados foram extra√≠dos da simula√ß√£o wokwi e carregados em um DataFrame do Pandas. Foram selecionadas as colunas relevantes e tratados valores ausentes.

- **Engenharia de atributos:**  
  Vari√°veis categ√≥ricas (como presen√ßa de f√≥sforo e pot√°ssio) foram convertidas para valores num√©ricos. A vari√°vel alvo foi definida como o status da bomba (`bomba`).

- **Divis√£o dos dados:**  
  Os dados foram divididos em conjuntos de treino e teste (80%/20%) para valida√ß√£o do modelo.

- **Treinamento do modelo:**  
  Foram testados diferentes algoritmos de classifica√ß√£o, como `RandomForestClassifier`, `DecisionTreeClassifier` e `LogisticRegression`. O modelo com melhor desempenho foi selecionado com base na acur√°cia.

- **Avalia√ß√£o:**  
  O modelo foi avaliado utilizando m√©tricas como acur√°cia. Os resultados mostraram boa capacidade de generaliza√ß√£o para o problema proposto.

### 3. Resultados

O modelo apresentou alta acur√°cia na predi√ß√£o do acionamento da bomba, indicando que as vari√°veis coletadas s√£o suficientes para automatizar a decis√£o de irriga√ß√£o. Isso permite que o sistema recomende ou acione a irriga√ß√£o de forma inteligente, reduzindo desperd√≠cios e otimizando o uso da √°gua.

O notebook completo com c√≥digo, gr√°ficos e an√°lises est√° dispon√≠vel no arquivo `machine_learning.ipynb`.

### 4. Exporta√ß√£o do Modelo com Joblib

Ap√≥s treinar e avaliar o modelo de Decision Tree com boa acur√°cia, utilizamos a biblioteca `joblib` para exportar o modelo treinado. Isso permite reutilizar o modelo em outros scripts ou aplica√ß√µes sem a necessidade de re-treinamento.

<br>

## Interface com Streamlit

A interface desenvolvida com **Streamlit** tem como objetivo proporcionar uma visualiza√ß√£o clara, interativa e acess√≠vel dos dados coletados pelo sistema de irriga√ß√£o inteligente. Ela permite que usu√°rios acompanhem o desempenho do sistema, analisem tend√™ncias e tomem decis√µes informadas sobre a irriga√ß√£o.

### Principais Funcionalidades

- **Dashboard Interativo:**  
  Exibe gr√°ficos em tempo real com os dados armazenados no banco SQLite, facilitando a an√°lise visual dos principais indicadores agr√≠colas.

- **Visualiza√ß√£o de Umidade do Solo:**  
  Gr√°fico de linha mostrando a evolu√ß√£o da umidade ao longo do tempo, com marca√ß√£o dos momentos em que a bomba de irriga√ß√£o foi acionada.

- **Monitoramento do pH do Solo:**  
  Gr√°fico de linha com faixa indicativa do intervalo ideal de pH, permitindo identificar rapidamente desvios e necessidade de corre√ß√£o.

<p align="center">
  <img src="assets/streamlit_dash1.png" alt="Dashboard Streamlit" width="80%">
</p>

- **Status dos Nutrientes (F√≥sforo e Pot√°ssio):**  
  Gr√°ficos de barras bin√°rios (presente/ausente) para f√≥sforo e pot√°ssio, facilitando o acompanhamento da disponibilidade desses nutrientes no solo.

<p align="center">
  <img src="assets/streamlit_dash2.png" alt="Dashboard Streamlit" width="80%">
</p>

- **Filtros e Sele√ß√£o de Per√≠odo:**  
  Possibilidade de filtrar os dados por intervalo de datas, permitindo an√°lises espec√≠ficas por per√≠odo.

<p align="center">
  <img src="assets/streamlit_dash4.png" alt="Dashboard Streamlit" width="80%">
</p>

- **Resumo Estat√≠stico:**  
  Exibe estat√≠sticas resumidas, como m√©dias, m√°ximos e m√≠nimos dos principais par√¢metros monitorados.

<p align="center">
  <img src="assets/streamlit_dash3.png" alt="Dashboard Streamlit" width="80%">
</p>


Al√©m do dashboard de visualiza√ß√£o, o projeto conta com uma interface Streamlit dedicada ao arquivo `machine_learning.py`, que permite ao usu√°rio interagir diretamente com o modelo preditivo treinado.

### Funcionalidades da Interface

- **Previs√£o de Irriga√ß√£o:**  
  O usu√°rio pode inserir manualmente valores para umidade do solo, pH, temperatura, presen√ßa de f√≥sforo e pot√°ssio. Com base nesses dados, a interface utiliza o modelo treinado para prever se a bomba de irriga√ß√£o deve ser acionada.

- **Formul√°rio Interativo:**  
  Campos deslizantes e seletores facilitam a entrada dos dados dos sensores, tornando o teste do modelo acess√≠vel mesmo para quem n√£o tem experi√™ncia em programa√ß√£o.

- **Exibi√ß√£o do Resultado:**  
  Ap√≥s o envio dos dados, a interface exibe de forma clara se a irriga√ß√£o √© recomendada ou n√£o, com base na predi√ß√£o do modelo.

- **Explica√ß√£o dos Par√¢metros:**  
  A interface inclui descri√ß√µes breves sobre cada par√¢metro de entrada, ajudando o usu√°rio a entender o impacto de cada vari√°vel na decis√£o do sistema.

<p align="center">
  <img src="assets/streamlit_machine_learning.png" alt="Machine Learning Streamlit" width="80%">
</p>

<br>

## Integra√ß√£o Serial Plotter

O projeto pode ser utilizado com o **Serial Plotter** do VS Code ou Arduino IDE para visualiza√ß√£o gr√°fica em tempo real das principais vari√°veis do sistema, como umidade, pH e status da bomba de irriga√ß√£o.

- Para usar o Serial Plotter, basta abrir o monitor serial no modo plotter ap√≥s iniciar o projeto.
- Os dados enviados pelo c√≥digo incluem informa√ß√µes de umidade, pH e status da bomba, permitindo acompanhar graficamente o comportamento do sistema ao longo do tempo.
- Cada vari√°vel pode ser visualizada em uma linha separada no gr√°fico, facilitando a an√°lise e o ajuste dos par√¢metros do sistema.

<br>

<img src="assets/serial_plotter.png" alt="Diagrama" border="0" width="60%" height="60%">

<br>

## Inclus√£o do display LCD no Wokwi

<p align="center">
  <img src="assets/circuito_diagrama.png" alt="Wokwi" width="80%">
</p>


O display LCD foi adicionado ao circuito simulado no Wokwi para proporcionar uma visualiza√ß√£o em tempo real dos principais dados coletados pelo sistema embarcado. Com essa inclus√£o, √© poss√≠vel exibir diretamente no hardware simulado informa√ß√µes como umidade do solo, valor de pH, status da bomba de irriga√ß√£o e presen√ßa de nutrientes (f√≥sforo e pot√°ssio).

A integra√ß√£o do LCD permite:

- Monitorar rapidamente os valores dos sensores sem depender apenas do monitor serial.
- Facilitar a demonstra√ß√£o do funcionamento do sistema em apresenta√ß√µes ou testes pr√°ticos.
- Simular de forma mais fiel como seria a experi√™ncia do usu√°rio em um dispositivo f√≠sico real.


No c√≥digo C++, foram implementadas fun√ß√µes para atualizar o display LCD a cada nova leitura dos sensores, garantindo que os dados exibidos estejam sempre atualizados. O diagrama do circuito no Wokwi foi ajustado para incluir as conex√µes necess√°rias entre o ESP32 e o display LCD, conforme ilustrado na imagem acima.

## üìÅ Estrutura do Projeto

```bash
/chap1-phase4-agricultural-machine
‚îú‚îÄ‚îÄ src/                                # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ application/                    # C√≥digo fonte do CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_operations.py            # Opera√ß√µes com o banco de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_setup.py                 # Setup do banco de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ farm_data.db                # Banco de dados SQLite
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # Fun√ß√£o main
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ weather_integration.py      # Integra√ß√£o com API de tempo
‚îÇ   ‚îú‚îÄ‚îÄ streamlit/                      # Interfaces streamlit
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/                      # Subp√°ginas streamlit
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ  dashboard.py           # Inteface dashboard
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ  machine_learning.py    # Interface previs√£o de machine learning
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ home.py                     # Interface padr√£o home
‚îÇ   ‚îú‚îÄ‚îÄ wokwi/                          # Simula√ß√£o wokwi
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/                        # C√≥digo fonte simula√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ  main.cpp               # Fun√ß√£o main
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ platformio.ini              # Configura√ß√£o do PlatformIO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ driagram.json               # Configura√ß√£o circuito
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wokwi.toml                  # Configura√ß√£o wokwi
‚îú‚îÄ‚îÄ assets/                             # Imagens utilizadas no README
‚îÇ   ‚îú‚îÄ‚îÄ circuito_diagrama_antigo.png 
‚îÇ   ‚îú‚îÄ‚îÄ circuito_diagrama.png          
‚îÇ   ‚îú‚îÄ‚îÄ logo-fiap.png                   
‚îÇ   ‚îú‚îÄ‚îÄ serial_plotter.png              
‚îÇ   ‚îú‚îÄ‚îÄ streamlit_dash1.png             
‚îÇ   ‚îú‚îÄ‚îÄ streamlit_dash2.png            
‚îÇ   ‚îú‚îÄ‚îÄ streamlit_dash3.png             
‚îÇ   ‚îú‚îÄ‚îÄ streamlit_dash4.png             
‚îÇ   ‚îî‚îÄ‚îÄ streamlit_machine_learning.png
‚îú‚îÄ‚îÄ documents/                          # Documentos utilizados
‚îÇ   ‚îú‚îÄ‚îÄ coletas-dados-normalizados.csv  # Arquivo com dados coletados normalizados        
‚îÇ   ‚îú‚îÄ‚îÄ coletas.csv                     # Arquivo com dados coletados brutos 
‚îÇ   ‚îú‚îÄ‚îÄ decision_tree_model.pkl         # Modelo treinado extra√≠do
‚îÇ   ‚îú‚îÄ‚îÄ machine_learning.ipynb          # Modelagem preditiva 
‚îÇ   ‚îî‚îÄ‚îÄ sample_data.txt                 # Arquivo usado na pliaca√ß√£o python
‚îú‚îÄ‚îÄ .gitignore                          # Arquivos/pastas ignorados pelo Git
‚îî‚îÄ‚îÄ README.md                           # Documenta√ß√£o geral do projeto
```

<br>

## ‚ñ∂Ô∏è Como Rodar o Projeto

### ‚úÖ Requisitos

- [Visual Studio Code (VS Code)](https://code.visualstudio.com/)
- Extens√µes instaladas no VS Code:
  - **PlatformIO IDE** (√≠cone da formiguinha üêú)
  - **Wokwi for VS Code** (√≠cone com `<>` da simula√ß√£o)
  - **SQL Viewer**
- Git instalado na m√°quina (para clonar o reposit√≥rio)
- As seguintes bibliotecas instaladas:
  ```bash
  pip install streamlit pandas matplotlib seaborn requests missingno sklearn joblib
  ```

---

## üîß Passo a Passo

### Parte 1 ‚Äì Simula√ß√£o do Hardware (ESP32 no Wokwi)

1. **Clone o reposit√≥rio**

   - Abra o terminal
   - Execute o comando:

     ```bash
     git clone https://github.com/fiap-ia-2025/chap1-phase4-agricultural-machine.git
     ```

<br>

2. **Abra o VS Code e carregue apenas a pasta /src/wokwi como uma janela separada.**

- N√£o abra a pasta raiz do reposit√≥rio. Clique em "Abrir Pasta" no VS Code e selecione diretamente `wokwi`.

<br>

3. **Compile o projeto com PlatformIO**

- No VS Code, clique no √≠cone da formiguinha üêú (PlatformIO) no menu lateral esquerdo
- Clique em **"Build"** para compilar o `main.cpp` (aguarde a conclus√£o)

<br>

4. **Execute a simula√ß√£o com Wokwi**

- Pressione `Ctrl+Shift+P` (ou `Cmd+Shift+P` no Mac) para abrir a Command Palette
- Digite `>Wokwi: Start Simulation` e pressione Enter
- A simula√ß√£o ser√° aberta no navegador com o firmware j√° compilado

  > Obs: certifique-se de que o projeto foi compilado primeiro com o bot√£o **Build** do PlatformIO.

<br>

5. **Acompanhe os dados no Monitor Serial**

- O monitor serial da simula√ß√£o mostrar√°:

  - Umidade lida pelo DHT22
  - Valor de pH (simulado via LDR)
  - Presen√ßa/aus√™ncia de f√≥sforo e pot√°ssio (bot√µes)
  - Estado da bomba (ligada ou desligada)
  - Temperatura

  <br>

6. **Copie a linha gerada no monitor serial da simula√ß√£o**

- A simula√ß√£o exibe os valores da simula√ß√£o. Copie os valores e gere uma linha igual a:

  ```bash
   P=Presente, K=Presente, Umidade=74.50%, pH=3.4, Bomba=0, Temperatura=30.0
  ```

  - Copie essa linha para usar na pr√≥xima etapa

  <br>

### Parte 2 ‚Äì Sistema de CRUD e Visualiza√ß√£o (Python)

7. **Abra outra janela do VS Code e carregue apenas a pasta `src`**


<br>

8. **Cole o dado simulado no arquivo `sample_data.txt`**

- Abra o arquivo `sample_data.txt` na pasta /documents
- Substitua ou adicione a linha copiada na simula√ß√£o.

  - ‚ö†Ô∏è **Aten√ß√£o:** apenas a **primeira linha** do arquivo (`linha 1`) ser√° processada pelo sistema, mesmo que o arquivo contenha v√°rias linhas

<br>

9. **Execute o sistema**

- No terminal do VS Code, na raiz do projeto, execute:

  ```bash
  python main.py
  ```

<br>

10. **Use o menu interativo para processar e manipular os dados:**

```bash
================================================================================
====================== Sistema de Monitoramento Agr√≠cola =======================
================================================================================

1. Processar Dados de Leitura
2. Visualizar Leituras
3. Atualizar Leitura
4. Excluir Leitura
5. Estat√≠sticas
6. Consultar Previs√£o do Tempo
0. Sair

Escolha uma op√ß√£o:
```

- Escolha a op√ß√£o 1 para processar os dados do `sample_data.txt` e inseri-los no banco SQLite.
- As demais op√ß√µes permitem visualizar, editar e consultar os dados armazenados.

<br>

11. **Rodar o Dashboard Streamlit**

- Execute o comando:
  ```bash
  streamlit run home.py
  ```
- Ap√≥s rodar acesse o dashboard no navegador pelo link: http://localhost:8501

<br>

## ‚úÖ Conclus√£o

O projeto consolida a aplica√ß√£o pr√°tica de tecnologias embarcadas, sensores, automa√ß√£o e ci√™ncia de dados para resolver um problema real da agricultura: **o uso eficiente e inteligente da √°gua.** Ao combinar sensores f√≠sicos, l√≥gica de controle, banco de dados e integra√ß√£o com fontes externas de informa√ß√£o, a solu√ß√£o oferece um modelo funcional de **agricultura de precis√£o** em n√≠vel educacional.

O desenvolvimento foi feito com foco em clareza, modularidade, boas pr√°ticas e documenta√ß√£o, refletindo tanto o aprendizado t√©cnico quanto a capacidade de estruturar solu√ß√µes completas em equipe.
